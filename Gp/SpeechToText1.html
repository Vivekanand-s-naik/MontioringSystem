<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Speech to Text</title>-->
<!--    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">-->
<!--</head>-->
<!--<body>-->

<!--    <div class="container">-->
<!--        <h1>üéôÔ∏è Speech to Text</h1>-->
<!--        <button id="start-recording">Start Recording</button>-->
<!--        <button id="stop-recording" disabled>Stop Recording</button>-->
<!--        <p><b>Recognized Text:</b></p>-->
<!--        <div id="output"></div>-->
<!--    </div>-->
<!--<style>-->
<!--    body {-->
<!--    font-family: Arial, sans-serif;-->
<!--    text-align: center;-->
<!--    background-color: #f4f4f4;-->
<!--    padding: 20px;-->
<!--}-->

<!--.container {-->
<!--    background: white;-->
<!--    max-width: 500px;-->
<!--    margin: auto;-->
<!--    padding: 20px;-->
<!--    border-radius: 10px;-->
<!--    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);-->
<!--}-->

<!--button {-->
<!--    padding: 10px 20px;-->
<!--    margin: 10px;-->
<!--    font-size: 16px;-->
<!--    border: none;-->
<!--    background-color: #007bff;-->
<!--    color: white;-->
<!--    cursor: pointer;-->
<!--    border-radius: 5px;-->
<!--}-->

<!--button:disabled {-->
<!--    background-color: gray;-->
<!--    cursor: not-allowed;-->
<!--}-->

<!--#output {-->
<!--    background: #f0f0f0;-->
<!--    padding: 10px;-->
<!--    min-height: 50px;-->
<!--    border-radius: 5px;-->
<!--}-->

<!--</style>-->
<!--    <script>-->
<!--        let mediaRecorder;-->
<!--        let audioChunks = [];-->

<!--        document.getElementById("start-recording").addEventListener("click", async () => {-->
<!--            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });-->
<!--            mediaRecorder = new MediaRecorder(stream);-->

<!--            document.getElementById("start-recording").disabled = true;-->
<!--            document.getElementById("stop-recording").disabled = false;-->

<!--            mediaRecorder.ondataavailable = (event) => {-->
<!--                audioChunks.push(event.data);-->
<!--            };-->

<!--            mediaRecorder.onstop = async () => {-->
<!--                const audioBlob = new Blob(audioChunks, { type: "audio/wav" });-->
<!--                const formData = new FormData();-->
<!--                formData.append("audio", audioBlob, "recording.wav");-->

<!--                const response = await fetch("/process_audio", {-->
<!--                    method: "POST",-->
<!--                    body: formData-->
<!--                });-->

<!--                const result = await response.json();-->
<!--                document.getElementById("output").innerText = result.text || "Error processing audio!";-->
<!--            };-->

<!--            mediaRecorder.start();-->
<!--        });-->

<!--        document.getElementById("stop-recording").addEventListener("click", () => {-->
<!--            mediaRecorder.stop();-->
<!--            document.getElementById("start-recording").disabled = false;-->
<!--            document.getElementById("stop-recording").disabled = true;-->
<!--        });-->
<!--    </script>-->

<!--</body>-->
<!--</html>-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Speech to Text</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #f4f4f4;
            padding: 20px;
        }
        .container {
            background: white;
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: 16px;
            border: none;
            background-color: #007bff;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }
        button:hover { background-color: #0056b3; }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        #results {
            margin-top: 20px;
            text-align: left;
        }
        .result-section {
            margin-bottom: 20px;
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
        }
        .output {
            min-height: 50px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéôÔ∏è Live Speech to Text</h1>
        <button id="start-recording">Start Recording</button>
        <button id="stop-recording" disabled>Stop Recording</button>

        <div id="results">
            <div class="result-section">
                <p><b>Live Recognized Text:</b></p>
                <div id="live-text" class="output">Waiting to start...</div>
            </div>

            <div class="result-section">
                <p><b>Final Text:</b></p>
                <div id="final-text" class="output">No recording yet...</div>
            </div>

            <div class="result-section">
                <p><b>Summary:</b></p>
                <div id="summary" class="output">No summary yet...</div>
            </div>
        </div>
    </div>

    <script>
        let mediaRecorder;
        let audioChunks = [];
        let liveTextElement = document.getElementById('live-text');
        let finalTextElement = document.getElementById('final-text');
        let summaryElement = document.getElementById('summary');

        document.getElementById("start-recording").addEventListener("click", async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream, {
                    mimeType: 'audio/webm',
                    audioBitsPerSecond: 16000
                });

                audioChunks = [];
                liveTextElement.innerText = 'Recording started...';
                finalTextElement.innerText = 'Processing...';
                summaryElement.innerText = 'Processing...';

                document.getElementById("start-recording").disabled = true;
                document.getElementById("stop-recording").disabled = false;

                mediaRecorder.ondataavailable = async (event) => {
                    if (event.data.size > 0) {
                        // Send audio chunk to server
                        const formData = new FormData();
                        formData.append('audio', event.data, 'chunk.webm');

                        try {
                            const response = await fetch('/process_audio_chunk', {
                                method: 'POST',
                                body: formData
                            });
                            const result = await response.json();

                            // Update live text if we have recognized text
                            if (result.text) {
                                liveTextElement.innerText += ' ' + result.text;
                            }
                        } catch (error) {
                            console.error('Error processing audio chunk:', error);
                        }
                    }
                };

                mediaRecorder.start(1000);  // Send chunks every second
            } catch (error) {
                console.error('Error starting recording:', error);
                alert('Could not start recording. Please check microphone permissions.');
            }
        });

        document.getElementById("stop-recording").addEventListener("click", async () => {
            mediaRecorder.stop();
            document.getElementById("start-recording").disabled = false;
            document.getElementById("stop-recording").disabled = true;

            // Finalize speech and get summary
            try {
                const response = await fetch('/finalize_speech', { method: 'POST' });
                const result = await response.json();

                finalTextElement.innerText = result.text || 'No text recognized';
                summaryElement.innerText = result.summary || 'No summary generated';
            } catch (error) {
                console.error('Error finalizing speech:', error);
                finalTextElement.innerText = 'Error processing final text';
                summaryElement.innerText = 'Error generating summary';
            }
        });
    </script>
</body>
</html>